{"version":3,"file":"js/epubreader.min.js","mappings":"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","sources":["webpack://epubjs-reader/./node_modules/d/index.js","webpack://epubjs-reader/./node_modules/es5-ext/function/noop.js","webpack://epubjs-reader/./node_modules/es5-ext/object/assign/index.js","webpack://epubjs-reader/./node_modules/es5-ext/object/assign/is-implemented.js","webpack://epubjs-reader/./node_modules/es5-ext/object/assign/shim.js","webpack://epubjs-reader/./node_modules/es5-ext/object/is-value.js","webpack://epubjs-reader/./node_modules/es5-ext/object/keys/index.js","webpack://epubjs-reader/./node_modules/es5-ext/object/keys/is-implemented.js","webpack://epubjs-reader/./node_modules/es5-ext/object/keys/shim.js","webpack://epubjs-reader/./node_modules/es5-ext/object/normalize-options.js","webpack://epubjs-reader/./node_modules/es5-ext/object/valid-callable.js","webpack://epubjs-reader/./node_modules/es5-ext/object/valid-value.js","webpack://epubjs-reader/./node_modules/es5-ext/string/\u0000#/contains/index.js","webpack://epubjs-reader/./node_modules/es5-ext/string/\u0000#/contains/is-implemented.js","webpack://epubjs-reader/./node_modules/es5-ext/string/\u0000#/contains/shim.js","webpack://epubjs-reader/./node_modules/event-emitter/index.js","webpack://epubjs-reader/./node_modules/type/function/is.js","webpack://epubjs-reader/./node_modules/type/object/is.js","webpack://epubjs-reader/./node_modules/type/plain-function/is.js","webpack://epubjs-reader/./node_modules/type/prototype/is.js","webpack://epubjs-reader/./node_modules/type/value/is.js","webpack://epubjs-reader/webpack/bootstrap","webpack://epubjs-reader/webpack/runtime/compat get default export","webpack://epubjs-reader/webpack/runtime/define property getters","webpack://epubjs-reader/webpack/runtime/hasOwnProperty shorthand","webpack://epubjs-reader/./src/ui.js","webpack://epubjs-reader/./src/panels/metadata_panel.js","webpack://epubjs-reader/./src/toolbar.js","webpack://epubjs-reader/./src/panels/toc_panel.js","webpack://epubjs-reader/./src/panels/bookmarks_panel.js","webpack://epubjs-reader/./src/panels/annotations_panel.js","webpack://epubjs-reader/./src/panels/search_panel.js","webpack://epubjs-reader/./src/panels/settings_panel.js","webpack://epubjs-reader/./src/sidebar.js","webpack://epubjs-reader/./src/content.js","webpack://epubjs-reader/./src/strings.js","webpack://epubjs-reader/./src/reader.js","webpack://epubjs-reader/./src/storage.js","webpack://epubjs-reader/./src/main.js"],"sourcesContent":["\"use strict\";\n\nvar isValue         = require(\"type/value/is\")\n  , isPlainFunction = require(\"type/plain-function/is\")\n  , assign          = require(\"es5-ext/object/assign\")\n  , normalizeOpts   = require(\"es5-ext/object/normalize-options\")\n  , contains        = require(\"es5-ext/string/#/contains\");\n\nvar d = (module.exports = function (dscr, value/*, options*/) {\n\tvar c, e, w, options, desc;\n\tif (arguments.length < 2 || typeof dscr !== \"string\") {\n\t\toptions = value;\n\t\tvalue = dscr;\n\t\tdscr = null;\n\t} else {\n\t\toptions = arguments[2];\n\t}\n\tif (isValue(dscr)) {\n\t\tc = contains.call(dscr, \"c\");\n\t\te = contains.call(dscr, \"e\");\n\t\tw = contains.call(dscr, \"w\");\n\t} else {\n\t\tc = w = true;\n\t\te = false;\n\t}\n\n\tdesc = { value: value, configurable: c, enumerable: e, writable: w };\n\treturn !options ? desc : assign(normalizeOpts(options), desc);\n});\n\nd.gs = function (dscr, get, set/*, options*/) {\n\tvar c, e, options, desc;\n\tif (typeof dscr !== \"string\") {\n\t\toptions = set;\n\t\tset = get;\n\t\tget = dscr;\n\t\tdscr = null;\n\t} else {\n\t\toptions = arguments[3];\n\t}\n\tif (!isValue(get)) {\n\t\tget = undefined;\n\t} else if (!isPlainFunction(get)) {\n\t\toptions = get;\n\t\tget = set = undefined;\n\t} else if (!isValue(set)) {\n\t\tset = undefined;\n\t} else if (!isPlainFunction(set)) {\n\t\toptions = set;\n\t\tset = undefined;\n\t}\n\tif (isValue(dscr)) {\n\t\tc = contains.call(dscr, \"c\");\n\t\te = contains.call(dscr, \"e\");\n\t} else {\n\t\tc = true;\n\t\te = false;\n\t}\n\n\tdesc = { get: get, set: set, configurable: c, enumerable: e };\n\treturn !options ? desc : assign(normalizeOpts(options), desc);\n};\n","\"use strict\";\n\n// eslint-disable-next-line no-empty-function\nmodule.exports = function () {};\n","\"use strict\";\n\nmodule.exports = require(\"./is-implemented\")() ? Object.assign : require(\"./shim\");\n","\"use strict\";\n\nmodule.exports = function () {\n\tvar assign = Object.assign, obj;\n\tif (typeof assign !== \"function\") return false;\n\tobj = { foo: \"raz\" };\n\tassign(obj, { bar: \"dwa\" }, { trzy: \"trzy\" });\n\treturn obj.foo + obj.bar + obj.trzy === \"razdwatrzy\";\n};\n","\"use strict\";\n\nvar keys  = require(\"../keys\")\n  , value = require(\"../valid-value\")\n  , max   = Math.max;\n\nmodule.exports = function (dest, src /*, …srcn*/) {\n\tvar error, i, length = max(arguments.length, 2), assign;\n\tdest = Object(value(dest));\n\tassign = function (key) {\n\t\ttry {\n\t\t\tdest[key] = src[key];\n\t\t} catch (e) {\n\t\t\tif (!error) error = e;\n\t\t}\n\t};\n\tfor (i = 1; i < length; ++i) {\n\t\tsrc = arguments[i];\n\t\tkeys(src).forEach(assign);\n\t}\n\tif (error !== undefined) throw error;\n\treturn dest;\n};\n","\"use strict\";\n\nvar _undefined = require(\"../function/noop\")(); // Support ES3 engines\n\nmodule.exports = function (val) { return val !== _undefined && val !== null; };\n","\"use strict\";\n\nmodule.exports = require(\"./is-implemented\")() ? Object.keys : require(\"./shim\");\n","\"use strict\";\n\nmodule.exports = function () {\n\ttry {\n\t\tObject.keys(\"primitive\");\n\t\treturn true;\n\t} catch (e) {\n\t\treturn false;\n\t}\n};\n","\"use strict\";\n\nvar isValue = require(\"../is-value\");\n\nvar keys = Object.keys;\n\nmodule.exports = function (object) { return keys(isValue(object) ? Object(object) : object); };\n","\"use strict\";\n\nvar isValue = require(\"./is-value\");\n\nvar forEach = Array.prototype.forEach, create = Object.create;\n\nvar process = function (src, obj) {\n\tvar key;\n\tfor (key in src) obj[key] = src[key];\n};\n\n// eslint-disable-next-line no-unused-vars\nmodule.exports = function (opts1 /*, …options*/) {\n\tvar result = create(null);\n\tforEach.call(arguments, function (options) {\n\t\tif (!isValue(options)) return;\n\t\tprocess(Object(options), result);\n\t});\n\treturn result;\n};\n","\"use strict\";\n\nmodule.exports = function (fn) {\n\tif (typeof fn !== \"function\") throw new TypeError(fn + \" is not a function\");\n\treturn fn;\n};\n","\"use strict\";\n\nvar isValue = require(\"./is-value\");\n\nmodule.exports = function (value) {\n\tif (!isValue(value)) throw new TypeError(\"Cannot use null or undefined\");\n\treturn value;\n};\n","\"use strict\";\n\nmodule.exports = require(\"./is-implemented\")() ? String.prototype.contains : require(\"./shim\");\n","\"use strict\";\n\nvar str = \"razdwatrzy\";\n\nmodule.exports = function () {\n\tif (typeof str.contains !== \"function\") return false;\n\treturn str.contains(\"dwa\") === true && str.contains(\"foo\") === false;\n};\n","\"use strict\";\n\nvar indexOf = String.prototype.indexOf;\n\nmodule.exports = function (searchString /*, position*/) {\n\treturn indexOf.call(this, searchString, arguments[1]) > -1;\n};\n","'use strict';\n\nvar d        = require('d')\n  , callable = require('es5-ext/object/valid-callable')\n\n  , apply = Function.prototype.apply, call = Function.prototype.call\n  , create = Object.create, defineProperty = Object.defineProperty\n  , defineProperties = Object.defineProperties\n  , hasOwnProperty = Object.prototype.hasOwnProperty\n  , descriptor = { configurable: true, enumerable: false, writable: true }\n\n  , on, once, off, emit, methods, descriptors, base;\n\non = function (type, listener) {\n\tvar data;\n\n\tcallable(listener);\n\n\tif (!hasOwnProperty.call(this, '__ee__')) {\n\t\tdata = descriptor.value = create(null);\n\t\tdefineProperty(this, '__ee__', descriptor);\n\t\tdescriptor.value = null;\n\t} else {\n\t\tdata = this.__ee__;\n\t}\n\tif (!data[type]) data[type] = listener;\n\telse if (typeof data[type] === 'object') data[type].push(listener);\n\telse data[type] = [data[type], listener];\n\n\treturn this;\n};\n\nonce = function (type, listener) {\n\tvar once, self;\n\n\tcallable(listener);\n\tself = this;\n\ton.call(this, type, once = function () {\n\t\toff.call(self, type, once);\n\t\tapply.call(listener, this, arguments);\n\t});\n\n\tonce.__eeOnceListener__ = listener;\n\treturn this;\n};\n\noff = function (type, listener) {\n\tvar data, listeners, candidate, i;\n\n\tcallable(listener);\n\n\tif (!hasOwnProperty.call(this, '__ee__')) return this;\n\tdata = this.__ee__;\n\tif (!data[type]) return this;\n\tlisteners = data[type];\n\n\tif (typeof listeners === 'object') {\n\t\tfor (i = 0; (candidate = listeners[i]); ++i) {\n\t\t\tif ((candidate === listener) ||\n\t\t\t\t\t(candidate.__eeOnceListener__ === listener)) {\n\t\t\t\tif (listeners.length === 2) data[type] = listeners[i ? 0 : 1];\n\t\t\t\telse listeners.splice(i, 1);\n\t\t\t}\n\t\t}\n\t} else {\n\t\tif ((listeners === listener) ||\n\t\t\t\t(listeners.__eeOnceListener__ === listener)) {\n\t\t\tdelete data[type];\n\t\t}\n\t}\n\n\treturn this;\n};\n\nemit = function (type) {\n\tvar i, l, listener, listeners, args;\n\n\tif (!hasOwnProperty.call(this, '__ee__')) return;\n\tlisteners = this.__ee__[type];\n\tif (!listeners) return;\n\n\tif (typeof listeners === 'object') {\n\t\tl = arguments.length;\n\t\targs = new Array(l - 1);\n\t\tfor (i = 1; i < l; ++i) args[i - 1] = arguments[i];\n\n\t\tlisteners = listeners.slice();\n\t\tfor (i = 0; (listener = listeners[i]); ++i) {\n\t\t\tapply.call(listener, this, args);\n\t\t}\n\t} else {\n\t\tswitch (arguments.length) {\n\t\tcase 1:\n\t\t\tcall.call(listeners, this);\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\tcall.call(listeners, this, arguments[1]);\n\t\t\tbreak;\n\t\tcase 3:\n\t\t\tcall.call(listeners, this, arguments[1], arguments[2]);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tl = arguments.length;\n\t\t\targs = new Array(l - 1);\n\t\t\tfor (i = 1; i < l; ++i) {\n\t\t\t\targs[i - 1] = arguments[i];\n\t\t\t}\n\t\t\tapply.call(listeners, this, args);\n\t\t}\n\t}\n};\n\nmethods = {\n\ton: on,\n\tonce: once,\n\toff: off,\n\temit: emit\n};\n\ndescriptors = {\n\ton: d(on),\n\tonce: d(once),\n\toff: d(off),\n\temit: d(emit)\n};\n\nbase = defineProperties({}, descriptors);\n\nmodule.exports = exports = function (o) {\n\treturn (o == null) ? create(base) : defineProperties(Object(o), descriptors);\n};\nexports.methods = methods;\n","\"use strict\";\n\nvar isPrototype = require(\"../prototype/is\");\n\nmodule.exports = function (value) {\n\tif (typeof value !== \"function\") return false;\n\n\tif (!hasOwnProperty.call(value, \"length\")) return false;\n\n\ttry {\n\t\tif (typeof value.length !== \"number\") return false;\n\t\tif (typeof value.call !== \"function\") return false;\n\t\tif (typeof value.apply !== \"function\") return false;\n\t} catch (error) {\n\t\treturn false;\n\t}\n\n\treturn !isPrototype(value);\n};\n","\"use strict\";\n\nvar isValue = require(\"../value/is\");\n\n// prettier-ignore\nvar possibleTypes = { \"object\": true, \"function\": true, \"undefined\": true /* document.all */ };\n\nmodule.exports = function (value) {\n\tif (!isValue(value)) return false;\n\treturn hasOwnProperty.call(possibleTypes, typeof value);\n};\n","\"use strict\";\n\nvar isFunction = require(\"../function/is\");\n\nvar classRe = /^\\s*class[\\s{/}]/, functionToString = Function.prototype.toString;\n\nmodule.exports = function (value) {\n\tif (!isFunction(value)) return false;\n\tif (classRe.test(functionToString.call(value))) return false;\n\treturn true;\n};\n","\"use strict\";\n\nvar isObject = require(\"../object/is\");\n\nmodule.exports = function (value) {\n\tif (!isObject(value)) return false;\n\ttry {\n\t\tif (!value.constructor) return false;\n\t\treturn value.constructor.prototype === value;\n\t} catch (error) {\n\t\treturn false;\n\t}\n};\n","\"use strict\";\n\n// ES3 safe\nvar _undefined = void 0;\n\nmodule.exports = function (value) { return value !== _undefined && value !== null; };\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","/**\r\n * @author mrdoob (https://github.com/mrdoob/ui.js)\r\n */\r\n\r\nconst errormsg = 'is not an instance of UIElement.';\r\n\r\n/**\r\n * UIElement\r\n * @param {object} dom\r\n */\r\nclass UIElement {\r\n\r\n    constructor(dom) {\r\n\r\n        this.dom = dom;\r\n    }\r\n\r\n    add() {\r\n\r\n        for (let i = 0; i < arguments.length; i++) {\r\n\r\n            const argument = arguments[i];\r\n\r\n            if (argument instanceof UIElement) {\r\n\r\n                this.dom.appendChild(argument.dom);\r\n\r\n            } else if (Array.isArray(argument)) {\r\n                \r\n                for (let j = 0; j < argument.length; j++) {\r\n\r\n                    const element = argument[j];\r\n\r\n                    if (element instanceof UIElement) {\r\n\r\n                        this.dom.appendChild(element.dom);\r\n\r\n                    } else {\r\n\r\n                        console.error('UIElement:', element, errormsg);\r\n                    }\r\n                }\r\n                \r\n            } else {\r\n\r\n                console.error('UIElement:', argument, errormsg);\r\n            }\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    remove() {\r\n\r\n        for (let i = 0; i < arguments.length; i++) {\r\n\r\n            const argument = arguments[i];\r\n\r\n            if (argument instanceof UIElement) {\r\n\r\n                this.dom.removeChild(argument.dom);\r\n\r\n            } else {\r\n\r\n                console.error('UIElement:', argument, errormsg);\r\n            }\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    clear() {\r\n\r\n        while (this.dom.children.length) {\r\n\r\n            this.dom.removeChild(this.dom.lastChild);\r\n        }\r\n    }\r\n\r\n    setId(id) {\r\n\r\n        this.dom.id = id;\r\n        return this;\r\n    }\r\n\r\n    getId() {\r\n\r\n        return this.dom.id;\r\n    }\r\n\r\n    setClass(name) {\r\n\r\n        this.dom.className = name;\r\n        return this;\r\n    }\r\n\r\n    addClass(name) {\r\n\r\n        this.dom.classList.add(name);\r\n        return this;\r\n    }\r\n\r\n    removeClass(name) {\r\n\r\n        this.dom.classList.remove(name);\r\n        return this;\r\n    }\r\n\r\n    setStyle(style, array) {\r\n\r\n        for (let i = 0; i < array.length; i++) {\r\n\r\n            this.dom.style[style] = array[i];\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    setDisabled(value) {\r\n\r\n        this.dom.disabled = value;\r\n        return this;\r\n    }\r\n\r\n    setTextContent(value) {\r\n\r\n        this.dom.textContent = value;\r\n        return this;\r\n    }\r\n\r\n    getRect() {\r\n\r\n        this.dom.getBoundingClientRect();\r\n        return this;\r\n    }\r\n}\r\n\r\n// properties\r\n\r\nconst properties = [\r\n    'position',\r\n    'left',\r\n    'top',\r\n    'right',\r\n    'bottom',\r\n    'width',\r\n    'height',\r\n    'border',\r\n    'borderLeft',\r\n    'borderTop',\r\n    'borderRight',\r\n    'borderBottom',\r\n    'borderColor',\r\n    'display',\r\n    'overflow',\r\n    'margin',\r\n    'marginLeft',\r\n    'marginTop',\r\n    'marginRight',\r\n    'marginBottom',\r\n    'padding',\r\n    'paddingLeft',\r\n    'paddingTop',\r\n    'paddingRight',\r\n    'paddingBottom',\r\n    'color',\r\n    'background',\r\n    'backgroundColor',\r\n    'opacity',\r\n    'fontSize',\r\n    'fontWeight',\r\n    'textAlign',\r\n    'textDecoration',\r\n    'textTransform',\r\n    'cursor',\r\n    'zIndex'\r\n];\r\n\r\nproperties.forEach(function (property) {\r\n\r\n    const method = 'set' +\r\n        property.substr(0, 1).toUpperCase() +\r\n        property.substr(1, property.length);\r\n\r\n    UIElement.prototype[method] = function () {\r\n\r\n        this.setStyle(property, arguments);\r\n\r\n        return this;\r\n    };\r\n});\r\n\r\n// events\r\n\r\nconst events = [\r\n    'KeyUp', \r\n    'KeyDown', \r\n    'MouseOver', \r\n    'MouseOut', \r\n    'Click', \r\n    'DblClick', \r\n    'Change', \r\n    'Input'\r\n];\r\n\r\nevents.forEach(function (event) {\r\n\r\n    const method = 'on' + event;\r\n\r\n    UIElement.prototype[method] = function (callback) {\r\n\r\n        this.dom.addEventListener(event.toLowerCase(), callback.bind(this), false);\r\n        return this;\r\n    };\r\n});\r\n\r\n/**\r\n * UISpan\r\n */\r\nclass UISpan extends UIElement {\r\n\r\n    constructor() {\r\n\r\n        super(document.createElement('span'));\r\n    }\r\n}\r\n\r\n/**\r\n * UIDiv\r\n */\r\nclass UIDiv extends UIElement {\r\n\r\n    constructor() {\r\n\r\n        super(document.createElement('div'));\r\n    }\r\n}\r\n\r\n/**\r\n * UIRow\r\n */\r\nclass UIRow extends UIDiv {\r\n\r\n    constructor() {\r\n\r\n        super();\r\n        this.dom.className = 'row';\r\n    }\r\n}\r\n\r\n/**\r\n * UIPanel\r\n */\r\nclass UIPanel extends UIDiv {\r\n\r\n    constructor() {\r\n\r\n        super();\r\n        this.dom.className = 'panel';\r\n    }\r\n}\r\n\r\nclass UILabel extends UIElement {\r\n\r\n    constructor(text, id) {\r\n\r\n        super(document.createElement('label'));\r\n        this.dom.textContent = text;\r\n        if (id) this.dom.htmlFor = id;\r\n    }\r\n}\r\n\r\n/**\r\n * UIText\r\n * @param {any} text\r\n */\r\nclass UIText extends UISpan {\r\n\r\n    constructor(text) {\r\n\r\n        super();\r\n        this.setValue(text);\r\n    }\r\n\r\n    getValue() {\r\n\r\n        return this.dom.textContent;\r\n    }\r\n\r\n    setValue(value) {\r\n\r\n        if (value !== undefined) {\r\n\r\n            this.dom.textContent = value;\r\n        }\r\n\r\n        return this;\r\n    }\r\n}\r\n\r\n/**\r\n * UILink\r\n * @param {*} uri\r\n * @param {*} label\r\n */\r\nclass UILink extends UIElement {\r\n\r\n    constructor(uri, label) {\r\n\r\n        super(document.createElement('a'));\r\n        this.dom.href = uri;\r\n        this.dom.textContent = label;\r\n    }\r\n}\r\n\r\n/**\r\n * UIInput\r\n * @param {any} value\r\n */\r\nclass UIInput extends UIElement {\r\n\r\n    constructor(type, value, title) {\r\n\r\n        super(document.createElement('input'));\r\n\r\n        this.dom.type = type;\r\n        this.dom.addEventListener('keydown', function (event) {\r\n\r\n            event.stopPropagation();\r\n\r\n        }, false);\r\n\r\n        this.setValue(value);\r\n        this.setTitle(title);\r\n    }\r\n\r\n    getName() {\r\n\r\n        return this.dom.name;\r\n    }\r\n\r\n    setName(name) {\r\n\r\n        this.dom.name = name;\r\n        return this;\r\n    }\r\n\r\n    getType() {\r\n\r\n        return this.dom.type;\r\n    }\r\n\r\n    setType(type) {\r\n\r\n        this.dom.type = type;\r\n        return this;\r\n    }\r\n\r\n    getValue() {\r\n\r\n        return this.dom.value;\r\n    }\r\n\r\n    setValue(value) {\r\n\r\n        if (value !== undefined) {\r\n            this.dom.value = value;\r\n        }\r\n        return this;\r\n    }\r\n\r\n    getTitle() {\r\n\r\n        return this.dom.title;\r\n    }\r\n\r\n    setTitle(text) {\r\n\r\n        if (text !== undefined) {\r\n            this.dom.title = text;\r\n        }\r\n        return this;\r\n    }\r\n\r\n    readonly(value) {\r\n\r\n        this.dom.readOnly = value;\r\n        return this;\r\n    }\r\n}\r\n\r\n/**\r\n * UITextArea\r\n */\r\nclass UITextArea extends UIElement {\r\n\r\n    constructor() {\r\n\r\n        super(document.createElement('textarea'));\r\n\r\n        this.dom.spellcheck = false;\r\n        this.dom.addEventListener('keydown', function (event) {\r\n\r\n            event.stopPropagation();\r\n\r\n            if (event.keyCode === 9) {\r\n\r\n                event.preventDefault();\r\n\r\n                const cursor = dom.selectionStart;\r\n\r\n                this.dom.value = this.dom.value.substring(0, cursor) + '\\t' + this.dom.value.substring(cursor);\r\n                this.dom.selectionStart = cursor + 1;\r\n                this.dom.selectionEnd = this.dom.selectionStart;\r\n            }\r\n\r\n        }, false);\r\n    }\r\n\r\n    getValue() {\r\n\r\n        return this.dom.value;\r\n    }\r\n\r\n    setValue(value) {\r\n\r\n        this.dom.value = value;\r\n        return this;\r\n    }\r\n}\r\n\r\n/**\r\n * The <select> element is used to create a drop-down list.\r\n */\r\nclass UISelect extends UIElement {\r\n\r\n    constructor() {\r\n\r\n        super(document.createElement('select'));\r\n    }\r\n\r\n    setMultiple(boolean) {\r\n\r\n        this.dom.multiple = boolean || false;\r\n        return this;\r\n    }\r\n\r\n    setOptions(options) {\r\n\r\n        const selected = this.dom.value;\r\n\r\n        while (this.dom.children.length > 0) {\r\n\r\n            this.dom.removeChild(this.dom.firstChild);\r\n        }\r\n\r\n        for (const key in options) {\r\n\r\n            const option = document.createElement('option');\r\n            option.value = key;\r\n            option.innerHTML = options[key];\r\n            this.dom.appendChild(option);\r\n        }\r\n\r\n        this.dom.value = selected;\r\n\r\n        return this;\r\n    }\r\n\r\n    getValue() {\r\n\r\n        return this.dom.value;\r\n    }\r\n\r\n    setValue(value) {\r\n\r\n        value = String(value);\r\n\r\n        if (this.dom.value !== value) {\r\n\r\n            this.dom.value = value;\r\n        }\r\n\r\n        return this;\r\n    }\r\n}\r\n\r\n/**\r\n * UICheckbox\r\n * @param {boolean} value\r\n */\r\nclass UICheckbox extends UIElement {\r\n\r\n    constructor(value) {\r\n\r\n        super(document.createElement('input'));\r\n\r\n        this.dom.type = 'checkbox';\r\n        this.setValue(value);\r\n    }\r\n\r\n    getName() {\r\n\r\n        return this.dom.name;\r\n    }\r\n\r\n    setName(name) {\r\n\r\n        this.dom.name = name;\r\n        return this;\r\n    }\r\n\r\n    getValue() {\r\n\r\n        return this.dom.checked;\r\n    }\r\n\r\n    setValue(value) {\r\n\r\n        if (value !== undefined) {\r\n\r\n            this.dom.checked = value;\r\n        }\r\n        return this;\r\n    }\r\n}\r\n\r\n/**\r\n * UIColor\r\n */\r\nclass UIColor extends UIElement {\r\n\r\n    constructor() {\r\n\r\n        super(document.createElement('input'));\r\n\r\n        try {\r\n\r\n            this.dom.type = 'color';\r\n            this.dom.value = '#ffffff';\r\n\r\n        } catch (e) {\r\n\r\n            console.exception(e);\r\n        }\r\n    }\r\n\r\n    getValue() {\r\n\r\n        return this.dom.value;\r\n    }\r\n\r\n    getHexValue() {\r\n\r\n        return parseInt(this.dom.value.substr(1), 16);\r\n    }\r\n\r\n    setValue(value) {\r\n\r\n        this.dom.value = value;\r\n        return this;\r\n    }\r\n\r\n    setHexValue(hex) {\r\n\r\n        this.dom.value = '#' + ('000000' + hex.toString(16)).slice(-6);\r\n        return this;\r\n    }\r\n}\r\n\r\n/**\r\n * UINumber\r\n * @param {any} number\r\n */\r\nclass UINumber extends UIElement {\r\n\r\n    constructor(number) {\r\n\r\n        super(document.createElement('input'));\r\n\r\n        \r\n        this.dom.type = 'number';\r\n        this.dom.value = '0.00';\r\n\r\n        this.value = 0;\r\n\r\n        this.min = - Infinity;\r\n        this.max = + Infinity;\r\n\r\n        this.precision = 2;\r\n        this.step = 1;\r\n        this.unit = '';\r\n        this.nudge = 0.01;\r\n\r\n        this.setValue(number);\r\n\r\n        const scope = this;\r\n\r\n        const changeEvent = document.createEvent('HTMLEvents');\r\n        changeEvent.initEvent('change', true, true);\r\n\r\n        let distance = 0;\r\n        let onMouseDownValue = 0;\r\n\r\n        const pointer = { x: 0, y: 0 };\r\n        const prevPointer = { x: 0, y: 0 };\r\n\r\n        function onMouseDown(event) {\r\n\r\n            event.preventDefault();\r\n\r\n            distance = 0;\r\n\r\n            onMouseDownValue = scope.value;\r\n\r\n            prevPointer.x = event.clientX;\r\n            prevPointer.y = event.clientY;\r\n\r\n            document.addEventListener('mousemove', onMouseMove, false);\r\n            document.addEventListener('mouseup', onMouseUp, false);\r\n        }\r\n\r\n        function onMouseMove(event) {\r\n\r\n            const currentValue = scope.value;\r\n\r\n            pointer.x = event.clientX;\r\n            pointer.y = event.clientY;\r\n\r\n            distance += (pointer.x - prevPointer.x) - (pointer.y - prevPointer.y);\r\n\r\n            let value = onMouseDownValue + (distance / (event.shiftKey ? 5 : 50)) * scope.step;\r\n            value = Math.min(scope.max, Math.max(scope.min, value));\r\n\r\n            if (currentValue !== value) {\r\n\r\n                scope.setValue(value);\r\n                scope.dom.dispatchEvent(changeEvent);\r\n            }\r\n\r\n            prevPointer.x = event.clientX;\r\n            prevPointer.y = event.clientY;\r\n        }\r\n\r\n        function onMouseUp() {\r\n\r\n            document.removeEventListener('mousemove', onMouseMove, false);\r\n            document.removeEventListener('mouseup', onMouseUp, false);\r\n\r\n            if (Math.abs(distance) < 2) {\r\n\r\n                scope.dom.focus();\r\n                scope.dom.select();\r\n            }\r\n        }\r\n\r\n        function onTouchStart(event) {\r\n\r\n            if (event.touches.length === 1) {\r\n\r\n                distance = 0;\r\n\r\n                onMouseDownValue = scope.value;\r\n\r\n                prevPointer.x = event.touches[0].pageX;\r\n                prevPointer.y = event.touches[0].pageY;\r\n\r\n                document.addEventListener('touchmove', onTouchMove, false);\r\n                document.addEventListener('touchend', onTouchEnd, false);\r\n            }\r\n        }\r\n\r\n        function onTouchMove(event) {\r\n\r\n            const currentValue = scope.value;\r\n\r\n            pointer.x = event.touches[0].pageX;\r\n            pointer.y = event.touches[0].pageY;\r\n\r\n            distance += (pointer.x - prevPointer.x) - (pointer.y - prevPointer.y);\r\n\r\n            let value = onMouseDownValue + (distance / (event.shiftKey ? 5 : 50)) * scope.step;\r\n            value = Math.min(scope.max, Math.max(scope.min, value));\r\n\r\n            if (currentValue !== value) {\r\n\r\n                scope.setValue(value);\r\n                scope.dom.dispatchEvent(changeEvent);\r\n            }\r\n\r\n            prevPointer.x = event.touches[0].pageX;\r\n            prevPointer.y = event.touches[0].pageY;\r\n        }\r\n\r\n        function onTouchEnd(event) {\r\n\r\n            if (event.touches.length === 0) {\r\n\r\n                document.removeEventListener('touchmove', onTouchMove, false);\r\n                document.removeEventListener('touchend', onTouchEnd, false);\r\n            }\r\n        }\r\n\r\n        function onChange() {\r\n\r\n            scope.setValue(this.value);\r\n        }\r\n\r\n        //function onFocus() {\r\n        //    dom.style.backgroundColor = '';\r\n        //    dom.style.cursor = '';\r\n        //}\r\n        //function onBlur() {\r\n        //    dom.style.backgroundColor = 'transparent';\r\n        //    dom.style.cursor = 'ns-resize';\r\n        //}\r\n\r\n        function onKeyDown(event) {\r\n\r\n            event.stopPropagation();\r\n\r\n            switch (event.keyCode) {\r\n\r\n                //case 13: // enter\r\n                //    dom.blur();\r\n                //    break;\r\n                case 38: // up\r\n                    event.preventDefault();\r\n                    scope.setValue(scope.getValue() + scope.nudge);\r\n                    scope.dom.dispatchEvent(changeEvent);\r\n                    break;\r\n                case 40: // down\r\n                    event.preventDefault();\r\n                    scope.setValue(scope.getValue() - scope.nudge);\r\n                    scope.dom.dispatchEvent(changeEvent);\r\n                    break;\r\n            }\r\n        }\r\n\r\n        //onBlur();\r\n        this.dom.addEventListener('keydown', onKeyDown, false);\r\n        this.dom.addEventListener('mousedown', onMouseDown, false);\r\n        this.dom.addEventListener('touchstart', onTouchStart, false);\r\n        this.dom.addEventListener('change', onChange, false);\r\n        //dom.addEventListener('focus', onFocus, false);\r\n        //dom.addEventListener('blur', onBlur, false);\r\n    }\r\n\r\n    getName() {\r\n\r\n        return this.dom.name;\r\n    }\r\n\r\n    setName(name) {\r\n\r\n        this.dom.name = name;\r\n        return this;\r\n    }\r\n\r\n    getValue() {\r\n\r\n        return parseFloat(this.dom.value);\r\n    }\r\n\r\n    setValue(value) {\r\n\r\n        if (value !== undefined) {\r\n\r\n            value = parseFloat(value);\r\n\r\n            if (value < this.min)\r\n                value = this.min;\r\n            if (value > this.max)\r\n                value = this.max;\r\n\r\n            this.value = value;\r\n            this.dom.value = value.toFixed(this.precision);\r\n\r\n            if (this.unit !== '')\r\n                this.dom.value += ' ' + this.unit;\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    setPrecision(precision) {\r\n\r\n        this.precision = precision;\r\n        return this;\r\n    }\r\n\r\n    setStep(step) {\r\n\r\n        this.step = step;\r\n        return this;\r\n    }\r\n\r\n    setNudge(nudge) {\r\n\r\n        this.nudge = nudge;\r\n        return this;\r\n    }\r\n\r\n    setRange(min, max) {\r\n\r\n        this.min = min;\r\n        this.max = max;\r\n\r\n        return this;\r\n    }\r\n\r\n    setUnit(unit) {\r\n\r\n        this.unit = unit;\r\n        return this;\r\n    }\r\n\r\n    setTitle(text) {\r\n\r\n        this.dom.title = text;\r\n        return this;\r\n    }\r\n}\r\n\r\n/**\r\n * UIInteger\r\n * @param {number} value\r\n * @param {number} step\r\n * @param {number} min\r\n * @param {number} max\r\n */\r\nclass UIInteger extends UIElement {\r\n\r\n    constructor(value, step, min, max) {\r\n\r\n        super(document.createElement('input'));\r\n\r\n        this.dom.type = 'number';\r\n        this.dom.value = value;\r\n\r\n        if (step != undefined)\r\n        {\r\n            this.dom.step = step;\r\n        }\r\n        \r\n        if (min !== undefined)\r\n        {\r\n            this.dom.min = min;\r\n        }\r\n\r\n        if (max !== undefined)\r\n        {\r\n            this.dom.max = max;\r\n        }\r\n    }\r\n\r\n    getValue() {\r\n\r\n        return this.dom.value;\r\n    }\r\n\r\n    setValue(value) {\r\n\r\n        if (value !== undefined) {\r\n            \r\n            this.dom.value = value;\r\n        }\r\n        return this;\r\n    }\r\n}\r\n\r\n/**\r\n * UIBreak\r\n */\r\nclass UIBreak extends UIElement {\r\n\r\n    constructor() {\r\n\r\n        super(document.createElement('br'));\r\n\r\n        this.dom.className = 'Break';\r\n    }\r\n}\r\n\r\n/**\r\n * UIHorizontalRule\r\n */\r\nclass UIHorizontalRule extends UIElement {\r\n\r\n    constructor() {\r\n\r\n        super(document.createElement('hr'));\r\n\r\n        this.dom.className = 'HorizontalRule';\r\n    }\r\n}\r\n\r\n/**\r\n * UIButton\r\n * @param {any} value\r\n */\r\nclass UIButton extends UIElement {\r\n\r\n    constructor(value) {\r\n\r\n        super(document.createElement('input'));\r\n\r\n        this.dom.type = 'button';\r\n\r\n        if (value !== undefined) {\r\n\r\n            this.dom.value = value;\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    setValue(value) {\r\n\r\n        this.dom.value = value;\r\n        return this;\r\n    }\r\n}\r\n\r\nclass UIProgress extends UIElement {\r\n\r\n    constructor(value) {\r\n\r\n        super(document.createElement('progress'));\r\n\r\n        this.dom.value = value;\r\n    }\r\n\r\n    setValue(value) {\r\n\r\n        this.dom.value = value;\r\n    }\r\n}\r\n\r\n/**\r\n * UITabbedPanel\r\n */\r\nclass UITabbedPanel extends UIDiv {\r\n\r\n    /**\r\n     * Constructor\r\n     * @param {*} align (horizontal | vertical)\r\n     */\r\n    constructor(align) {\r\n\r\n        super();\r\n\r\n        this.tabs = [];\r\n        this.panels = [];\r\n        this.selector = new UISpan().setClass('tab-selector');\r\n\r\n        this.tabsDiv = new UIDiv();\r\n        this.tabsDiv.dom.className = 'tabs';\r\n        this.tabsDiv.add(this.selector);\r\n\r\n        this.panelsDiv = new UIDiv();\r\n        this.panelsDiv.dom.className = 'panels';\r\n\r\n        this.add(this.tabsDiv);\r\n        this.add(this.panelsDiv);\r\n\r\n        this.align = align || 'horizontal';\r\n        this.selected = '';\r\n    }\r\n\r\n    select(id) {\r\n\r\n        let tab;\r\n        let panel;\r\n\r\n        // Deselect current selection\r\n        if (this.selected && this.selected.length) {\r\n\r\n            tab = this.tabs.find((item) => {\r\n\r\n                return item.dom.id === this.selected;\r\n            });\r\n\r\n            panel = this.panels.find((item) => {\r\n\r\n                return item.dom.id === this.selected;\r\n            });\r\n\r\n            if (tab) {\r\n\r\n                tab.removeClass('selected');\r\n            }\r\n\r\n            if (panel) {\r\n\r\n                panel.setDisplay('none');\r\n            }\r\n        }\r\n\r\n        tab = this.tabs.find(function (item) {\r\n\r\n            return item.dom.id === id;\r\n        });\r\n\r\n        panel = this.panels.find(function (item) {\r\n\r\n            return item.dom.id === id;\r\n        });\r\n\r\n        if (tab) {\r\n\r\n            tab.addClass('selected');\r\n            //\r\n            // transforming the tab-selector element\r\n            //\r\n            let size;\r\n            const rect = tab.dom.getBoundingClientRect();\r\n            if (this.align === 'horizontal') {\r\n                size = rect.width * this.tabs.indexOf(tab);\r\n                this.selector.dom.style.transform = `translateX(${size}px)`;\r\n            } else {\r\n                size = rect.height * this.tabs.indexOf(tab);\r\n                this.selector.dom.style.transform = `translateY(${size}px)`;\r\n            }\r\n        }\r\n\r\n        if (panel) {\r\n\r\n            panel.setDisplay('');\r\n        }\r\n\r\n        this.selected = id;\r\n\r\n        return this;\r\n    }\r\n\r\n    addTab(id, label, items) {\r\n\r\n        const tab = new UITab(label, this);\r\n        tab.setId(id);\r\n        tab.setClass('tab');\r\n        this.tabs.push(tab);\r\n        this.tabsDiv.add(tab);\r\n\r\n        const panel = new UIDiv();\r\n        panel.setId(id);\r\n        panel.add(items);\r\n        panel.setDisplay('none');\r\n        this.panels.push(panel);\r\n        this.panelsDiv.add(panel);\r\n\r\n        this.select(id);\r\n    }\r\n}\r\n\r\n/**\r\n * UITab\r\n */\r\nclass UITab extends UIDiv {\r\n\r\n    constructor(text, parent) {\r\n\r\n        super(text);\r\n\r\n        this.button = new UIInput('button');\r\n        this.button.dom.title = text;\r\n        this.parent = parent;\r\n        this.dom.addEventListener('click', () => {\r\n\r\n            this.parent.select(this.dom.id);\r\n\r\n        });\r\n        this.add(this.button);\r\n    }\r\n}\r\n\r\n/**\r\n * UIListbox\r\n */\r\nclass UIListbox extends UIElement {\r\n\r\n    constructor() {\r\n\r\n        super(document.createElement('select'));\r\n        \r\n        this.dom.multiple = true;\r\n\r\n        this.items = [];\r\n        this.listItems = [];\r\n        this.selectedIndex = -1;\r\n        this.selectedValue = null;\r\n\r\n        return this;\r\n    }\r\n\r\n    setItems(items) {\r\n\r\n        this.items = items;\r\n        this.dom.options.length = 0;\r\n\r\n        for (let i = 0; i < items.length; i++) {\r\n\r\n            this.setItem(items[i]);\r\n        }\r\n    }\r\n\r\n    selectIndex(index) {\r\n\r\n        this.selectValue(index);\r\n    }\r\n\r\n    selectValue(index) {\r\n\r\n        let value = null;\r\n\r\n        for (let i = 0; i < this.dom.options.length; i++) {\r\n\r\n            const option = this.dom.options[i];\r\n\r\n            if (index === i) {\r\n\r\n                option.selected = true;\r\n                option.className = 'selected';\r\n                value = parseInt(option.value);\r\n\r\n            } else {\r\n\r\n                option.selected = false;\r\n                option.className = '';\r\n            }\r\n        }\r\n\r\n        this.selectedValue = value;\r\n        this.selectedIndex = index;\r\n    }\r\n\r\n    getValue() {\r\n\r\n        return this.selectedValue;\r\n    }\r\n\r\n    setItem(item) {\r\n\r\n        const option = document.createElement('option');\r\n        option.value = item.id;\r\n        option.text = item.type;\r\n        option.addEventListener('click', (event) => {\r\n\r\n            this.selectValue(event.target.index);\r\n\r\n        }, false);\r\n\r\n        this.dom.appendChild(option);\r\n        this.listItems.push(item);\r\n\r\n        return this;\r\n    }\r\n}\r\n\r\n/**\r\n * UITreeView\r\n */\r\nclass UITreeView extends UIElement {\r\n\r\n    constructor() {\r\n\r\n        super(document.createElement('ul'));\r\n    }\r\n}\r\n\r\n/**\r\n * UITreeViewItem\r\n * @param {*} id\r\n * @param {*} link\r\n * @param {*} parent\r\n */\r\nclass UITreeViewItem extends UIElement {\r\n\r\n    constructor(id, link, parent) {\r\n\r\n        super(document.createElement('li'));\r\n        this.dom.id = id;\r\n        this.link = link;\r\n        this.parent = parent;\r\n        this.toggle = new UISpan().setClass('toggle-collapsed');\r\n        this.expander = new UIDiv().setId('expander');\r\n        this.expanded = false;\r\n        this.selected = false;\r\n        this.add([this.expander, this.link]);\r\n    }\r\n\r\n    setItems(subItems) {\r\n\r\n        this.add(subItems);\r\n        this.toggle.dom.onclick = () => {\r\n\r\n            if (this.expanded) {\r\n                this.collaps();\r\n            } else {\r\n                this.expand();\r\n            }\r\n            return false;\r\n        };\r\n        this.expander.add(this.toggle);\r\n\r\n        if (!this.expanded) {\r\n\r\n            const items = subItems.dom.getElementsByTagName('li');\r\n            for (let item of items) {\r\n                if (item.className === 'selected') {\r\n                    this.expand();\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    select() {\r\n\r\n        this.selected = true;\r\n        this.setClass('selected');\r\n    }\r\n\r\n    unselect() {\r\n\r\n        this.selected = false;\r\n        this.dom.removeAttribute('class');\r\n    }\r\n\r\n    expand() {\r\n\r\n        this.toggle.setClass('toggle-expanded');\r\n        this.dom.children[2].style.display = 'block';\r\n        this.expanded = true;\r\n    }\r\n\r\n    collaps() {\r\n\r\n        this.toggle.setClass('toggle-collapsed');\r\n        this.dom.children[2].style.display = 'none';\r\n        this.expanded = false;\r\n    }\r\n}\r\n\r\nexport {\r\n    UIElement,\r\n    UISpan,\r\n    UIDiv,\r\n    UIRow,\r\n    UIPanel,\r\n    UILabel,\r\n    UIText,\r\n    UILink,\r\n    UIInput,\r\n    UITextArea,\r\n    UISelect,\r\n    UICheckbox,\r\n    UIColor,\r\n    UINumber,\r\n    UIInteger,\r\n    UIBreak,\r\n    UIHorizontalRule,\r\n    UIButton,\r\n    UIProgress,\r\n    UITabbedPanel,\r\n    UITab,\r\n    UIListbox,\r\n    UITreeView,\r\n    UITreeViewItem\r\n};\r\n","import { UIPanel, UIText } from '../ui.js';\r\n\r\nexport class MetadataPanel extends UIPanel {\r\n\t\r\n\tconstructor(reader) {\r\n\t\t\r\n\t\tsuper();\r\n\t\tsuper.setId('metadata');\r\n\r\n\t\tthis.title = new UIText().setId('book-title');\r\n\t\tthis.creator = new UIText().setId('book-creator');\r\n\t\tthis.separator = new UIText().setId('book-title-separator');\r\n\r\n\t\tsuper.add([this.title, this.separator, this.creator]);\r\n\r\n\t\t//-- events --//\r\n\r\n\t\treader.on('metadata', (meta) => {\r\n\r\n\t\t\tthis.init(meta);\r\n\t\t});\r\n\t}\r\n\r\n\tinit(meta) {\r\n\t\t\r\n\t\tdocument.title = meta.title + \" – \" + meta.creator;\r\n\r\n\t\tthis.title.setValue(meta.title);\r\n\t\tthis.creator.setValue(meta.creator);\r\n\t\tthis.separator.dom.style.display = 'inline-block';\r\n\t}\r\n}\r\n","import { UIPanel, UIDiv, UIInput } from './ui.js';\r\nimport { MetadataPanel } from './panels/metadata_panel.js';\r\n\r\nexport class Toolbar {\r\n    \r\n    constructor(reader) {\r\n\r\n        const strings = reader.strings;\r\n\r\n        const container = new UIDiv().setId('toolbar');\r\n\r\n        const start = new UIPanel().setId('start');\r\n        const opener = new UIInput('button').setId('btn-s');\r\n        const openerStr = strings.get('toolbar/opener');\r\n        opener.dom.title = openerStr;\r\n        opener.dom.onclick = () => {\r\n\r\n            const isOpen = opener.dom.classList.length > 0;\r\n\r\n            reader.emit('sidebaropener', !isOpen);\r\n\r\n            if (!isOpen) {\r\n                opener.addClass('open');\r\n            } else {\r\n                opener.removeClass('open');\r\n            }\r\n        };\r\n\r\n        start.add(opener);\r\n\r\n        const center = new MetadataPanel(reader);\r\n\r\n        const end = new UIPanel().setId('end');\r\n        const open = new UIInput('file').setId('btn-o');\r\n        const uploadStr = strings.get('toolbar/openbook');\r\n        const storage = window.storage;\r\n        open.dom.title = uploadStr;\r\n        open.dom.accept = 'application/epub+zip';\r\n        open.dom.addEventListener('change', function (e) {\r\n\r\n            if (e.target.files.length === 0)\r\n                return;\r\n\r\n            if (window.FileReader) {\r\n\r\n                const fr = new FileReader();\r\n                fr.onload = function (e) {\r\n                    storage.clear();\r\n                    storage.set(e.target.result, () => {\r\n                        reader.unload();\r\n                        reader.init(e.target.result, { restore: true });\r\n                    });\r\n                };\r\n                fr.readAsArrayBuffer(e.target.files[0]);\r\n                fr.onerror = function (e) {\r\n                    console.error(e);\r\n                };\r\n\r\n                if (window.location.href.includes(\"?bookPath=\")) {\r\n                    window.location.href = window.location.origin + window.location.pathname;\r\n                }\r\n\r\n            } else {\r\n                alert(strings.get('toolbar/openbook/error'));\r\n            }\r\n        }, false);\r\n\r\n        end.add(open);\r\n\r\n        const bookmark = new UIInput('button').setId('btn-b');\r\n        const bookmarkStr = strings.get('toolbar/bookmark');\r\n        bookmark.dom.title = bookmarkStr;\r\n        bookmark.dom.addEventListener('click', () => {\r\n\r\n            const cfi = reader.rendition.currentLocation().start.cfi;\r\n            reader.emit('bookmarked', reader.isBookmarked(cfi) === -1);\r\n        });\r\n\r\n        end.add(bookmark);\r\n\r\n        if (document.fullscreenEnabled) {\r\n            \r\n            const fullscreen = new UIInput('button').setId('btn-f');\r\n            const fullscreenStr = strings.get('toolbar/fullsceen');\r\n            fullscreen.dom.title = fullscreenStr;\r\n            fullscreen.dom.addEventListener('click', () => {\r\n                \r\n                this.toggleFullScreen();\r\n            });\r\n\r\n            document.addEventListener('keydown', (e) => {\r\n            \r\n                if (e.key === 'F11') {\r\n                    e.preventDefault();\r\n                    this.toggleFullScreen();\r\n                }\r\n            }, false);\r\n\r\n            document.addEventListener('fullscreenchange', (e) => {\r\n\r\n                const w = window.screen.width === e.path[2].innerWidth;\r\n                const h = window.screen.height === e.path[2].innerHeight;\r\n                \r\n                if (w && h) {\r\n                    fullscreen.addClass('resize-small');\r\n                } else {\r\n                    fullscreen.removeClass('resize-small');\r\n                }\r\n            }, false);\r\n\r\n            end.add(fullscreen);\r\n        }\r\n\r\n        container.add([start, center, end]);\r\n        document.body.appendChild(container.dom);\r\n\r\n        //-- events --//\r\n\r\n        reader.on('relocated', (location) => {\r\n\r\n            const cfi = location.start.cfi;\r\n\r\n            if (reader.isBookmarked(cfi) === -1) {\r\n                bookmark.removeClass('bookmarked');\r\n            } else {\r\n                bookmark.addClass('bookmarked');\r\n            }\r\n        });\r\n\r\n        reader.on('bookmarked', (value) => {\r\n\r\n            if (value) {\r\n                bookmark.addClass('bookmarked');\r\n            } else {\r\n                bookmark.removeClass('bookmarked');\r\n            }\r\n        });\r\n    }\r\n\r\n    toggleFullScreen() {\r\n        \r\n        document.activeElement.blur();\r\n        \r\n        if (document.fullscreenElement === null) {\r\n            document.documentElement.requestFullscreen();\r\n        } else if (document.exitFullscreen) {\r\n            document.exitFullscreen();\r\n        }\r\n    }\r\n}\r\n","import { UIPanel, UITreeView, UITreeViewItem, UILink } from '../ui.js';\r\n\r\nexport class TocPanel extends UIPanel {\r\n    \r\n    constructor(reader) {\r\n        \r\n        super();\r\n        super.setId('contents');\r\n\r\n        this.reader = reader;\r\n        this.selector = undefined; // save reference to selected tree item\r\n\r\n        //-- events --//\r\n\r\n        reader.on('navigation', (toc) => {\r\n\r\n            this.init(toc);\r\n        });\r\n    }\r\n\r\n    init(toc) {\r\n\r\n        super.clear();\r\n        super.add(this.generateToc(toc));\r\n    }\r\n\r\n    generateToc(toc, parent) {\r\n\r\n        const container = new UITreeView();\r\n\r\n        toc.forEach((chapter) => {\r\n\r\n            const link = new UILink(chapter.href, chapter.label);\r\n            const treeItem = new UITreeViewItem(chapter.id, link, parent);\r\n\r\n            link.dom.onclick = () => {\r\n\r\n                this.reader.rendition.display(chapter.href);\r\n                if (this.selector && this.selector !== treeItem) {\r\n                    this.selector.unselect();\r\n                }\r\n                treeItem.select();\r\n                this.selector = treeItem;\r\n                this.reader.emit('tocselected', chapter.id);\r\n                return false;\r\n            };\r\n\r\n            if (this.reader.settings.sectionId === chapter.id) {\r\n                treeItem.select();\r\n                this.selector = treeItem;\r\n            }\r\n\r\n            if (chapter.subitems && chapter.subitems.length > 0) {\r\n                \r\n                treeItem.setItems(this.generateToc(chapter.subitems, treeItem));\r\n            }\r\n\r\n            container.add(treeItem);\r\n        });\r\n\r\n        return container;\r\n    }\r\n}\r\n","import { UIPanel, UIRow, UIInput } from '../ui.js';\r\n\r\nexport class BookmarksPanel extends UIPanel {\r\n\r\n    constructor(reader) {\r\n        \r\n        super();\r\n        super.setId('bookmarks');\r\n\r\n        const strings = reader.strings;\r\n\r\n        const ctrlRow = new UIRow();\r\n        const ctrlStr = [\r\n            strings.get('sidebar/bookmarks/add'),\r\n            strings.get('sidebar/bookmarks/remove'),\r\n            strings.get('sidebar/bookmarks/clear'),\r\n        ];\r\n        const btn_a = new UIInput('button', ctrlStr[0]).addClass('btn-start');\r\n        const btn_r = new UIInput('button', ctrlStr[1]).addClass('btn-medium');\r\n        const btn_c = new UIInput('button', ctrlStr[2]).addClass('btn-end');\r\n\r\n        btn_a.dom.onclick = () => {\r\n\r\n            reader.emit('bookmarked', true);\r\n            return false;\r\n        };\r\n\r\n        btn_r.dom.onclick = () => {\r\n\r\n            reader.emit('bookmarked', false);\r\n            return false;\r\n        };\r\n\r\n        btn_c.dom.onclick = () => {\r\n\r\n            this.clearBookmarks();\r\n            reader.emit('bookmarked', false);\r\n            return false;\r\n        };\r\n\r\n        ctrlRow.add([btn_a, btn_r, btn_c]);\r\n\r\n        this.reader = reader;\r\n        this.bookmarks = document.createElement('ul');\r\n        \r\n        super.add(ctrlRow);\r\n        this.dom.appendChild(this.bookmarks);\r\n\r\n        const update = () => {\r\n\r\n            btn_r.dom.disabled = reader.settings.bookmarks.length === 0;\r\n            btn_c.dom.disabled = reader.settings.bookmarks.length === 0;\r\n        };\r\n\r\n        //-- events --//\r\n\r\n        reader.on ('bookready', () => {\r\n\r\n            reader.settings.bookmarks.forEach((cfi) => {\r\n                \r\n                const bookmark = this.createBookmarkItem(cfi);\r\n                this.bookmarks.appendChild(bookmark);\r\n            });\r\n\r\n            update();\r\n        });\r\n\r\n        reader.on('relocated', (location) => {\r\n\r\n            const cfi = location.start.cfi;\r\n            const val = reader.isBookmarked(cfi) === -1;\r\n            btn_a.dom.disabled = !val;\r\n            btn_r.dom.disabled = val;\r\n        });\r\n\r\n        reader.on('bookmarked', (value) => {\r\n\r\n            const cfi = reader.rendition.currentLocation().start.cfi;\r\n\r\n            if (value) {\r\n                this.addBookmark(cfi);\r\n                btn_a.dom.disabled = true;\r\n            } else {\r\n                this.removeBookmark(cfi);\r\n                btn_a.dom.disabled = false;\r\n            }\r\n\r\n            update();\r\n        });\r\n    }\r\n\r\n    addBookmark(cfi) {\r\n\r\n        if (this.reader.isBookmarked(cfi) > -1)\r\n            return;\r\n\r\n        const bookmark = this.createBookmarkItem(cfi);\r\n        this.bookmarks.appendChild(bookmark);\r\n        this.reader.settings.bookmarks.push(cfi);\r\n    }\r\n\r\n    removeBookmark(cfi) {\r\n\r\n        const index = this.reader.isBookmarked(cfi);\r\n        if (index === -1)\r\n            return;\r\n\r\n        this.bookmarks.removeChild(this.bookmarks.childNodes[index]);\r\n        this.reader.settings.bookmarks.splice(index, 1);\r\n    }\r\n\r\n    clearBookmarks() {\r\n\r\n        this.reader.settings.bookmarks = [];\r\n        while (this.bookmarks.hasChildNodes()) {\r\n            this.bookmarks.removeChild(this.bookmarks.lastChild);\r\n        }\r\n    }\r\n\r\n    createBookmarkItem(cfi) {\r\n\r\n        const item = document.createElement('li');\r\n        const link = document.createElement('a');\r\n\r\n        const book = this.reader.book;\r\n        const spineItem = book.spine.get(cfi);\r\n        \r\n        if (spineItem.index in book.navigation.toc) {\r\n            const tocItem = book.navigation.toc[spineItem.index];\r\n            item.id = tocItem.id;\r\n            link.textContent = tocItem.label;\r\n        } else {\r\n            link.textContent = cfi;\r\n        }\r\n\r\n        link.href = \"#\" + cfi;\r\n        link.onclick = () => {\r\n\r\n            this.reader.rendition.display(cfi);\r\n            return false;\r\n        };\r\n\r\n        item.appendChild(link);\r\n        return item;\r\n    }\r\n}\r\n","import { UIPanel, UIRow, UITextArea, UIInput } from '../ui.js';\r\n\r\nexport class AnnotationsPanel extends UIPanel {\r\n\r\n\tconstructor(reader) {\r\n\t\t\r\n\t\tsuper();\r\n\t\tsuper.setId('annotations');\r\n\r\n\t\tconst strings = reader.strings;\r\n\t\tconst ctrlStr = [\r\n\t\t\tstrings.get('sidebar/annotations/add'),\r\n\t\t\tstrings.get('sidebar/annotations/clear')\r\n\t\t];\r\n\r\n\t\tthis.reader = reader;\r\n\t\tthis.notes = document.createElement('ul');\r\n\r\n\t\tconst textBox = new UITextArea();\r\n\t\ttextBox.dom.addEventListener('input', (e) => {\r\n\r\n\t\t\tif (isSelected() && e.target.value.length > 0) {\r\n\t\t\t\tbtn_a.dom.disabled = false;\r\n\t\t\t} else {\r\n\t\t\t\tbtn_a.dom.disabled = true;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tconst selector = {\r\n\t\t\trange: undefined,\r\n\t\t\tcfiRange: undefined\r\n\t\t};\r\n\r\n\t\tconst textRow = new UIRow();\r\n\t\tconst ctrlRow = new UIRow();\r\n\r\n\t\tconst btn_a = new UIInput('button', ctrlStr[0]).addClass('btn-start');\r\n\t\tbtn_a.dom.disabled = true;\r\n\t\tbtn_a.dom.onclick = () => {\r\n\r\n\t\t\tconst note = {\r\n\t\t\t\tdate: new Date(),\r\n\t\t\t\ttext: textBox.getValue(),\r\n\t\t\t\thref: selector.cfiRange,\r\n\t\t\t\tuuid: reader.uuid()\r\n\t\t\t};\r\n\r\n\t\t\treader.settings.annotations.push(note);\r\n\r\n\t\t\tthis.add(note);\r\n\r\n\t\t\ttextBox.setValue('');\r\n\t\t\tbtn_a.dom.disabled = true;\r\n\t\t\treturn false;\r\n\t\t};\r\n\r\n\t\tconst btn_c = new UIInput('button', ctrlStr[1]).addClass('btn-end');\r\n\t\tbtn_c.dom.disabled = true;\r\n\t\tbtn_c.dom.onclick = () => {\r\n\r\n\t\t\tthis.clearNotes();\r\n\t\t\treturn false;\r\n\t\t};\r\n\r\n\t\ttextRow.add(textBox);\r\n\t\tctrlRow.add([btn_a, btn_c]);\r\n\r\n\t\tsuper.add([textRow, ctrlRow]);\r\n\t\tthis.dom.appendChild(this.notes);\r\n\r\n\t\tthis.update = () => {\r\n\r\n\t\t\tbtn_c.dom.disabled = reader.settings.annotations.length === 0;\r\n\t\t};\r\n\r\n\t\tconst isSelected = () => {\r\n\r\n\t\t\treturn selector.range && selector.range.startOffset !== selector.range.endOffset;\r\n\t\t};\r\n\r\n\t\t//-- events --//\r\n\r\n\t\treader.on('bookready', () => {\r\n\r\n\t\t\treader.settings.annotations.forEach((note) => {\r\n\r\n\t\t\t\tthis.add(note);\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\treader.on('selected', (cfiRange, contents) => {\r\n\r\n\t\t\tselector.range = contents.range(cfiRange);\r\n\t\t\tselector.cfiRange = cfiRange;\r\n\r\n\t\t\tif (isSelected() && textBox.getValue().length > 0) {\r\n\t\t\t\tbtn_a.dom.disabled = false;\r\n\t\t\t} else {\r\n\t\t\t\tbtn_a.dom.disabled = true;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treader.on('unselected', () => {\r\n\r\n\t\t\tbtn_a.dom.disabled = true;\r\n\t\t});\r\n\t}\r\n\r\n\tadd(note) {\r\n\r\n\t\tconst item = document.createElement('li');\r\n\t\tconst link = document.createElement('a');\r\n\t\tconst btnr = document.createElement('span');\r\n\t\tconst call = () => {};\r\n\t\t\r\n\t\tlink.href = \"#\" + note.href;\r\n\t\tlink.textContent = note.text;\r\n\t\tlink.onclick = () => {\r\n\r\n\t\t\tthis.reader.rendition.display(note.href);\r\n\t\t\treturn false;\r\n\t\t};\r\n\r\n\t\titem.id = 'note-' + note.uuid;\r\n\t\titem.appendChild(link);\r\n\r\n\t\tbtnr.className = 'btn-remove';\r\n\t\tbtnr.onclick = () => {\r\n\t\t\t\r\n\t\t\tthis.remove(note);\r\n\t\t\treturn false;\r\n\t\t};\r\n\t\t\r\n\t\titem.appendChild(btnr);\r\n\r\n\t\tthis.notes.appendChild(item);\r\n\t\tthis.reader.rendition.annotations.add(\r\n\t\t\t\"highlight\", note.href, {}, call, \"note-highlight\", {});\r\n\t\tthis.update();\r\n\t}\r\n\r\n\tremove(note) {\r\n\r\n\t\tconst index = this.reader.settings.annotations.indexOf(note);\r\n\t\tif (index === -1)\r\n\t\t\treturn;\r\n\r\n\t\tthis.notes.removeChild(this.notes.childNodes[index]);\r\n\t\tthis.reader.settings.annotations.splice(index, 1);\r\n\t\tthis.reader.rendition.annotations.remove(note.href, \"highlight\");\r\n\t\tthis.update();\r\n\t}\r\n\r\n\tclearNotes() {\r\n\r\n\t\tconst len = this.reader.settings.annotations.length;\r\n\t\tfor(let i = 0; i < len; i++) {\r\n\r\n\t\t\tthis.remove(this.reader.settings.annotations[i]);\r\n\t\t}\r\n\t}\r\n}\r\n","import { UIPanel, UIRow, UIInput } from '../ui.js';\r\n\r\nexport class SearchPanel extends UIPanel {\r\n\r\n    constructor(reader) {\r\n\r\n        super();\r\n        super.setId('search');\r\n        \r\n        const strings = reader.strings;\r\n\r\n        let searchQuery = undefined;\r\n        const searchBox = new UIInput('search');\r\n        searchBox.dom.placeholder = strings.get('sidebar/search/placeholder');\r\n        searchBox.dom.onsearch = () => {\r\n\r\n            const value = searchBox.getValue();\r\n            \r\n            if (value.length === 0) {\r\n                this.clear();\r\n            } else if (searchQuery !== value) {\r\n                this.clear();\r\n                this.doSearch(value).then(results => {\r\n\r\n                    results.forEach(item => {\r\n                        this.set(item);\r\n                    });\r\n                });\r\n            }\r\n            searchQuery = value;\r\n        };\r\n\r\n        const ctrlRow = new UIRow();\r\n        ctrlRow.add(searchBox);\r\n        super.add(ctrlRow);\r\n\r\n        this.items = document.createElement('ul');\r\n        this.dom.appendChild(this.items);\r\n        this.reader = reader;\r\n        //\r\n        // improvement of the highlighting of keywords is required...\r\n        //\r\n    }\r\n\r\n    /**\r\n     * Searching the entire book\r\n     * @param {*} q Query keyword\r\n     * @returns The search result array.\r\n     */\r\n    async doSearch(q) {\r\n\r\n        const book = this.reader.book;\r\n        const results = await Promise.all(\r\n            book.spine.spineItems.map(item => item.load(book.load.bind(book))\r\n            .then(item.find.bind(item, q)).finally(item.unload.bind(item))));\r\n        return await Promise.resolve([].concat.apply([], results));\r\n    }\r\n\r\n    set(data) {\r\n\r\n        const item = document.createElement('li');\r\n        const link = document.createElement('a');\r\n\r\n        link.href = \"#\" + data.cfi;\r\n        link.textContent = data.excerpt;\r\n        link.onclick = () => {\r\n\r\n            this.reader.rendition.display(data.cfi);\r\n            return false;\r\n        };\r\n\r\n        item.appendChild(link);\r\n        this.items.appendChild(item);\r\n    }\r\n\r\n    clear() {\r\n\r\n        while (this.items.hasChildNodes()) {\r\n            this.items.removeChild(this.items.lastChild);\r\n        }\r\n    }\r\n}","import { UIPanel, UIRow, UISelect, UIInput, UILabel, UIInteger } from '../ui.js';\r\n\r\nexport class SettingsPanel extends UIPanel {\r\n\r\n\tconstructor(reader) {\r\n\r\n\t\tsuper();\r\n\t\tsuper.setId('settings');\r\n\t\t\r\n\t\tconst strings = reader.strings;\r\n\r\n\t\tconst languageStr = strings.get('sidebar/settings/language');\r\n\t\tconst languageRow = new UIRow();\r\n\t\tconst language = new UISelect().setOptions({\r\n\t\t\ten: 'English', \r\n\t\t\tfr: 'French', \r\n\t\t\tja: 'Japanese', \r\n\t\t\tru: 'Russian'\r\n\t\t});\r\n\t\tlanguage.dom.addEventListener('change', (e) => {\r\n\r\n\t\t\treader.settings.language = e.target.value;\r\n\t\t});\r\n\r\n\t\tlanguageRow.add(new UILabel(languageStr));\r\n\t\tlanguageRow.add(language);\r\n\r\n\t\tconst fontSizeStr = strings.get('sidebar/settings/fontsize');\r\n\t\tconst fontSizeRow = new UIRow();\r\n\t\tconst fontSize = new UIInteger(100, 1);\r\n\t\tfontSize.dom.addEventListener('change', (e) => {\r\n\r\n\t\t\treader.emit('fontresize', e.target.value);\r\n\t\t});\r\n\r\n\t\tfontSizeRow.add(new UILabel(fontSizeStr));\r\n\t\tfontSizeRow.add(fontSize);\r\n\r\n\t\tconst reflowTextStr = strings.get('sidabar/settings/reflowtext');\r\n\t\tconst reflowTextRow = new UIRow();\r\n\t\tconst reflowText = new UIInput('checkbox', false, reflowTextStr[1]);\r\n\t\treflowText.setId('reflowtext');\r\n\t\treflowText.dom.addEventListener('click', (e) => {\r\n\r\n\t\t\treader.settings.reflowText = e.target.checked;\r\n\t\t\treader.rendition.resize();\r\n\t\t});\r\n\r\n\t\treflowTextRow.add(new UILabel(reflowTextStr[0], 'reflowtext'));\r\n\t\treflowTextRow.add(reflowText);\r\n\r\n\t\tconst paginationStr = strings.get('sidebar/settings/pagination');\r\n\t\tconst paginationRow = new UIRow();\r\n\t\tconst pagination = new UIInput('checkbox', false, paginationStr[1]);\r\n\t\tpagination.setId('pagination');\r\n\t\tpagination.dom.addEventListener('click', (e) => {\r\n\r\n\t\t\treader.settings.pagination = e.target.checked;\r\n\t\t\treader.generatePagination(); // not implemented\r\n\t\t});\r\n\r\n\t\tpaginationRow.add(new UILabel(paginationStr[0], 'pagination'));\r\n\t\tpaginationRow.add(pagination);\r\n\r\n\t\tsuper.add([\r\n\t\t\tlanguageRow,\r\n\t\t\tfontSizeRow,\r\n\t\t\t//reflowTextRow,\r\n\t\t\t//paginationRow\r\n\t\t]);\r\n\r\n\t\t//-- events --//\r\n\r\n\t\treader.on('bookready', () => {\r\n\r\n\t\t\tlanguage.setValue(reader.settings.language);\r\n\t\t});\r\n\r\n\t\treader.on('fontresize', (value) => {\r\n\r\n\t\t\tif (fontSize.getValue() !== value) {\r\n\t\t\t\tfontSize.setValue(value);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n","import { UITabbedPanel } from './ui.js';\r\nimport { TocPanel } from './panels/toc_panel.js';\r\nimport { BookmarksPanel } from './panels/bookmarks_panel.js';\r\nimport { AnnotationsPanel } from './panels/annotations_panel.js';\r\nimport { SearchPanel } from './panels/search_panel.js';\r\nimport { SettingsPanel } from './panels/settings_panel.js';\r\n\r\nexport class Sidebar {\r\n    \r\n    constructor(reader) {\r\n        \r\n        const strings = reader.strings;\r\n        const tabs = [\r\n            strings.get('sidebar/contents'),\r\n            strings.get('sidebar/bookmarks'),\r\n            strings.get('sidebar/annotations'),\r\n            strings.get('sidebar/search'),\r\n            strings.get('sidebar/settings')\r\n        ];\r\n\r\n        this.toc = new TocPanel(reader);\r\n        this.bookmarks = new BookmarksPanel(reader);\r\n        this.annotations = new AnnotationsPanel(reader);\r\n        this.search = new SearchPanel(reader);\r\n        this.settings = new SettingsPanel(reader);\r\n\r\n        this.container = new UITabbedPanel('vertical').setId('sidebar');\r\n\r\n        this.container.addTab('tab-t', tabs[0], this.toc);\r\n        this.container.addTab('tab-b', tabs[1], this.bookmarks);\r\n        this.container.addTab('tab-n', tabs[2], this.annotations);\r\n        this.container.addTab('tab-s', tabs[3], this.search);\r\n        this.container.addTab('tab-c', tabs[4], this.settings);\r\n\r\n        this.container.select('tab-t');\r\n\r\n        document.body.appendChild(this.container.dom);\r\n    }\r\n}","import { UIDiv, UILabel } from './ui.js';\r\n\r\nexport class Content {\r\n\r\n    constructor(reader) {\r\n        \r\n        this.main = new UIDiv().setId('content');\r\n        this.main.dom.addEventListener('transitionend', (e) => {\r\n\r\n            if (reader.settings.sidebarReflow) {\r\n                reader.rendition.resize();\r\n            }\r\n        });\r\n\r\n        const prev = new UIDiv().setId('prev').setClass('arrow');\r\n        prev.dom.onclick = (e) => {\r\n\r\n            reader.emit('prev');\r\n            e.preventDefault();\r\n        };\r\n        prev.add(new UILabel('<'));\r\n\r\n        const next = new UIDiv().setId('next').setClass('arrow');\r\n        next.dom.onclick = (e) => {\r\n            \r\n            reader.emit('next');\r\n            e.preventDefault();\r\n        };\r\n        next.add(new UILabel('>'));\r\n\r\n        const viewer  = new UIDiv().setId('viewer');\r\n        const divider = new UIDiv().setId('divider');\r\n        const loader  = new UIDiv().setId('loader');\r\n\r\n        const showDivider = () => {\r\n            divider.dom.style.display = 'block';\r\n        };\r\n\r\n        const hideDivider = () => {\r\n            divider.dom.style.display = 'none';\r\n        };\r\n\r\n        const showLoader = () => {\r\n            loader.dom.style.display = 'block';\r\n            hideDivider();\r\n        };\r\n\r\n        const hideLoader = () => {\r\n            loader.dom.style.display = 'none';\r\n\r\n            //-- If the book is using spreads, show the divider\r\n            if(reader.book.settings.spreads) {\r\n                showDivider();\r\n            }\r\n        };\r\n\r\n        this.main.add([prev, viewer, next, divider, loader]);\r\n\r\n        this.reader = reader;\r\n        \r\n        document.body.appendChild(this.main.dom);\r\n\r\n        //-- events --//\r\n\r\n        reader.on('bookloaded', () => {\r\n\r\n            hideLoader();\r\n        });\r\n\r\n        reader.on('sidebaropener', (value) => {\r\n            \r\n            if (value) {\r\n                this.slideOut();\r\n            } else {\r\n                this.slideIn();\r\n            }\r\n        });\r\n\r\n        reader.on('layout', (props) => {\r\n\r\n            if (props.spread === true && props.width > props.spreadWidth) {\r\n                showDivider();\r\n            } else {\r\n                hideDivider();\r\n            }\r\n        });\r\n\r\n        reader.on('relocated', (location) => {\r\n\r\n            if (location.atStart) {\r\n                prev.addClass('disabled');\r\n            } else {\r\n                prev.removeClass('disabled');\r\n            }\r\n\r\n            if (location.atEnd) {\r\n                next.addClass('disabled');\r\n            } else {\r\n                next.removeClass('disabled');\r\n            }\r\n        });\r\n\r\n        reader.on('prev', () => {\r\n\r\n            prev.addClass('active');\r\n            setTimeout(() => { prev.removeClass('active'); }, 100);\r\n        });\r\n\r\n        reader.on('next', () => {\r\n\r\n            next.addClass('active');\r\n            setTimeout(() => { next.removeClass('active'); }, 100);\r\n        });\r\n\r\n        reader.on('viewercleanup', () => {\r\n\r\n            viewer.clear();\r\n        });\r\n    }\r\n\r\n    slideIn() {\r\n\r\n        //var currentPosition = rendition.currentLocation().start.cfi;\r\n        if (this.reader.settings.sidebarReflow) {\r\n            //this.main.removeClass('single');\r\n        } else {\r\n            //this.main.removeClass('closed');\r\n        }\r\n\r\n        this.main.removeClass('single');\r\n        this.main.removeClass('closed');\r\n    }\r\n\r\n    slideOut() {\r\n        /*\r\n        var location = rendition.currentLocation();\r\n        if (!location) {\r\n            return;\r\n        }\r\n        var currentPosition = location.start.cfi;\r\n        */\r\n        if (this.reader.settings.sidebarReflow) {\r\n            this.main.addClass('single');\r\n        } else {\r\n            this.main.addClass('closed');\r\n        }\r\n    }\r\n}","export class Strings {\r\n\r\n    constructor(reader) {\r\n\r\n        this.language = reader.settings.language || 'en';\r\n        this.values = {\r\n            en: {\r\n                'toolbar/opener': 'Sidebar',\r\n                'toolbar/openbook': 'Open book',\r\n                'toolbar/openbook/error': 'Your browser does not support the required features.\\nPlease use a modern browser such as Google Chrome, or Mozilla Firefox.',\r\n                'toolbar/bookmark': 'Add this page to bookmarks',\r\n                'toolbar/fullsceen': 'Fullscreen',\r\n\r\n                'sidebar/contents': 'Contents',\r\n                'sidebar/bookmarks': 'Bookmarks',\r\n                'sidebar/bookmarks/add': 'Add',\r\n                'sidebar/bookmarks/remove': 'Remove',\r\n                'sidebar/bookmarks/clear': 'Clear',\r\n                'sidebar/annotations': 'Annotations',\r\n                'sidebar/annotations/add': 'Add',\r\n                'sidebar/annotations/clear': 'Clear',\r\n                'sidebar/annotations/anchor': 'Anchor',\r\n                'sidebar/annotations/cancel': 'Cancel',\r\n                'sidebar/search': 'Search',\r\n                'sidebar/search/placeholder': 'search',\r\n                'sidebar/settings': 'Settings',\r\n                'sidebar/settings/language': 'Language',\r\n                'sidebar/settings/fontsize': 'Font size (%)',\r\n                'sidabar/settings/reflowtext': ['Reflow text', 'Reflow text when sidebars are open'],\r\n                'sidebar/settings/pagination': ['Pagination', 'Generate pagination']\r\n            },\r\n            fr: {\r\n                'toolbar/opener': 'Barre latérale',\r\n                'toolbar/openbook': 'Ouvrir un livre local',\r\n                'toolbar/openbook/error': 'Votre navigateur ne prend pas en charge les fonctions nécessaires.\\nVeuillez utiliser un navigateur moderne tel que Google Chrome ou Mozilla Firefox.',\r\n                'toolbar/bookmark': 'Insérer un marque page ici',\r\n                'toolbar/fullsceen': 'Plein écran',\r\n\r\n                'sidebar/contents': 'Sommaire',\r\n                'sidebar/bookmarks': 'Marque-pages',\r\n                'sidebar/bookmarks/add': 'Ajouter',\r\n                'sidebar/bookmarks/remove': 'Retirer',\r\n                'sidebar/bookmarks/clear': 'Tout enlever',\r\n                'sidebar/annotations': 'Annotations',\r\n                'sidebar/annotations/add': 'Ajouter',\r\n                'sidebar/annotations/clear': 'Tout enlever',\r\n                'sidebar/annotations/anchor': 'Ancre',\r\n                'sidebar/annotations/cancel': 'Annuler',\r\n                'sidebar/search': 'Rechercher',\r\n                'sidebar/search/placeholder': 'rechercher',\r\n                'sidebar/settings': 'Réglages',\r\n                'sidebar/settings/language': 'Langue',\r\n                'sidebar/settings/fontsize': '???',\r\n                'sidabar/settings/reflowtext': ['Réagencer', 'Réagencer les lignes lorsque le panneau latéral est ouvert'],\r\n                'sidebar/settings/pagination': ['Pagination', 'Établir une pagination']\r\n            },\r\n            ja: {\r\n                'toolbar/opener': 'サイドバー',\r\n                'toolbar/openbook': '本を開く',\r\n                'toolbar/openbook/error': 'ご利用のブラウザは必要な機能をサポートしていません。\\nGoogle Chrome、Mozilla Firefox、その他のモダンなブラウザでご利用ください。',\r\n                'toolbar/bookmark': 'このページに栞を設定する',\r\n                'toolbar/fullsceen': 'フルスクリーン',\r\n\r\n                'sidebar/contents': '目次',\r\n                'sidebar/bookmarks': '栞',\r\n                'sidebar/bookmarks/add': '追加',\r\n                'sidebar/bookmarks/remove': '削除',\r\n                'sidebar/bookmarks/clear': 'クリア',\r\n                'sidebar/annotations': '注釈',\r\n                'sidebar/annotations/add': '追加',\r\n                'sidebar/annotations/clear': 'クリア',\r\n                'sidebar/annotations/anchor': 'アンカー',\r\n                'sidebar/annotations/cancel': 'キャンセル',\r\n                'sidebar/search': '検索',\r\n                'sidebar/search/placeholder': '検索',\r\n                'sidebar/settings': '設定',\r\n                'sidebar/settings/language': '表示言語',\r\n                'sidebar/settings/fontsize': '???',\r\n                'sidabar/settings/reflowtext': ['再配置', 'サイドバーを開いた時に、テキストを再配置します。'],\r\n                'sidebar/settings/pagination': ['ページネーション', 'ページネーションを生成します。']\r\n            },\r\n            ru: {\r\n                'toolbar/opener': 'Боковая панель',\r\n                'toolbar/openbook': 'Открыть книгу',\r\n                'toolbar/openbook/error': 'Ваш браузер не поддерживает необходимые функции.\\nПожалуйста, используйте современный браузер, такой как Google Chrome или Mozilla Firefox.',\r\n                'toolbar/bookmark': 'Добавить эту страницу в закладки',\r\n                'toolbar/fullsceen': 'Полноэкранный режим',\r\n\r\n                'sidebar/contents': 'Содержание',\r\n                'sidebar/bookmarks': 'Закладки',\r\n                'sidebar/bookmarks/add': 'Добавить',\r\n                'sidebar/bookmarks/remove': 'Удалить',\r\n                'sidebar/bookmarks/clear': 'Очистить',\r\n                'sidebar/annotations': 'Аннотации',\r\n                'sidebar/annotations/add': 'Добавить',\r\n                'sidebar/annotations/clear': 'Очистить',\r\n                'sidebar/annotations/anchor': 'Метка',\r\n                'sidebar/annotations/cancel': 'Отмена',\r\n                'sidebar/search': 'Поиск',\r\n                'sidebar/search/placeholder': 'поиск...',\r\n                'sidebar/settings': 'Настройки',\r\n                'sidebar/settings/language': 'Язык',\r\n                'sidebar/settings/fontsize': 'Размер шрифта',\r\n                'sidabar/settings/reflowtext': ['Перекомпоновать текст', 'Перекомпоновать текст при открытых боковых панелях'],\r\n                'sidebar/settings/pagination': ['Нумерация страниц', 'Генерировать нумерацию страниц']\r\n            }\r\n        };\r\n    }\r\n\r\n    get(key) { return this.values[this.language][key] || '???'; }\r\n}\r\n","import EventEmitter from \"event-emitter\";\r\n\r\nimport { Toolbar } from './toolbar.js';\r\nimport { Sidebar } from './sidebar.js';\r\nimport { Content } from './content.js';\r\nimport { Strings } from './strings.js';\r\n\r\nexport class Reader {\r\n\r\n    constructor(bookPath, _options) {\r\n\r\n        this.settings = undefined;\r\n        this.cfgInit(bookPath, _options);\r\n\r\n        this.strings = new Strings(this);\r\n        this.toolbar = new Toolbar(this);\r\n        this.sidebar = new Sidebar(this);\r\n        this.content = new Content(this);\r\n\r\n        this.book = undefined;\r\n        this.rendition = undefined;\r\n        this.displayed = undefined;\r\n\r\n        this.init();\r\n\r\n        window.addEventListener('beforeunload', this.unload.bind(this), false);\r\n        window.addEventListener('hashchange', this.hashChanged.bind(this), false);\r\n        window.addEventListener('keydown', this.keyboardHandler.bind(this), false);\r\n        window.addEventListener('wheel', (e) => {\r\n            if (e.ctrlKey) {\r\n                e.preventDefault();\r\n            }\r\n        }, { passive: false });\r\n    }\r\n\r\n    /**\r\n     * Initialize book.\r\n     * @param {*} bookPath \r\n     * @param {*} _options \r\n     */\r\n    init(bookPath, _options) {\r\n\r\n        this.emit('viewercleanup');\r\n        \r\n        if (arguments.length > 0) {\r\n\r\n            this.cfgInit(bookPath, _options);\r\n        }\r\n\r\n        this.book = ePub(this.settings.bookPath);\r\n        this.rendition = this.book.renderTo('viewer', {\r\n            width: '100%',\r\n            height: '100%'\r\n        });\r\n\r\n        const cfi = this.settings.previousLocationCfi;\r\n        if (cfi) {\r\n            this.displayed = this.rendition.display(cfi);\r\n        } else {\r\n            this.displayed = this.rendition.display();\r\n        }\r\n\r\n        this.displayed.then((renderer) => {\r\n            this.emit('renderered', renderer);\r\n        });\r\n\r\n        this.book.ready.then(function () {\r\n            if (this.settings.pagination) {\r\n                this.generatePagination();\r\n            }\r\n            this.emit('bookready');\r\n            this.emit('fontresize', parseInt(this.settings.styles.fontSize));\r\n        }.bind(this)).then(function () {\r\n            this.emit('bookloaded');\r\n        }.bind(this));\r\n\r\n        this.book.loaded.metadata.then((meta) => {\r\n            this.emit('metadata', meta);\r\n        });\r\n\r\n        this.book.loaded.navigation.then((toc) => {\r\n            this.emit('navigation', toc);\r\n        });\r\n\r\n        this.rendition.on('click', (e) => {\r\n            const selection = e.view.document.getSelection();\r\n            const range = selection.getRangeAt(0);\r\n            if (range.startOffset === range.endOffset) {\r\n                this.emit('unselected');\r\n            }\r\n        });\r\n\r\n        this.rendition.on('layout', (props) => {\r\n            this.emit('layout', props);\r\n        });\r\n\r\n        this.rendition.on('selected', (cfiRange, contents) => {\r\n            this.setLocation(cfiRange);\r\n            this.emit('selected', cfiRange, contents);\r\n        });\r\n\r\n        this.rendition.on('relocated', (location) => {\r\n            this.setLocation(location.start.cfi);\r\n            this.emit('relocated', location);\r\n        });\r\n\r\n        this.on('fontresize', (value) => {\r\n            const fontSize = value + \"%\";\r\n            this.settings.styles.fontSize = fontSize;\r\n            this.rendition.themes.fontSize(fontSize);\r\n        });\r\n\r\n        this.on('prev', () => {\r\n            if (this.book.package.metadata.direction === 'rtl') {\r\n                this.rendition.next();\r\n            } else {\r\n                this.rendition.prev();\r\n            }\r\n        });\r\n\r\n        this.on('next', () => {\r\n            if (this.book.package.metadata.direction === 'rtl') {\r\n                this.rendition.prev();\r\n            } else {\r\n                this.rendition.next();\r\n            }\r\n        });\r\n\r\n        this.on('tocselected', (sectionId) => {\r\n            this.settings.sectionId = sectionId;\r\n        });\r\n    }\r\n\r\n    /* ------------------------------- Common ------------------------------- */\r\n\r\n    defaults(obj) {\r\n\r\n        for (let i = 1, length = arguments.length; i < length; i++) {\r\n            const source = arguments[i];\r\n            for (let prop in source) {\r\n                if (obj[prop] === void 0)\r\n                    obj[prop] = source[prop];\r\n            }\r\n        }\r\n        return obj;\r\n    }\r\n\r\n    uuid() {\r\n\r\n        let d = new Date().getTime();\r\n        const uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {\r\n            let r = (d + Math.random() * 16) % 16 | 0;\r\n            d = Math.floor(d / 16);\r\n            return (c === 'x' ? r : (r & 0x7 | 0x8)).toString(16);\r\n        });\r\n        return uuid;\r\n    }\r\n\r\n    /* ------------------------------ Bookmarks ----------------------------- */\r\n\r\n    /**\r\n     * Verifying the current page in bookmarks.\r\n     * @param {*} cfi \r\n     * @returns The index of the bookmark if it exists, or -1 otherwise.\r\n     */\r\n    isBookmarked(cfi) {\r\n\r\n        return this.settings.bookmarks.indexOf(cfi);\r\n    }\r\n\r\n    /* ----------------------------- Annotations ---------------------------- */\r\n\r\n    isAnnotated(note) {\r\n\r\n        return this.settings.annotations.indexOf(note);\r\n    }\r\n\r\n    /* ------------------------------ Settings ------------------------------ */\r\n\r\n    /**\r\n     * Initialize book settings.\r\n     * @param {*} bookPath\r\n     * @param {*} _options\r\n     */\r\n    cfgInit(bookPath, _options) {\r\n\r\n        this.settings = this.defaults(_options || {}, {\r\n            bookKey: this.getBookKey(bookPath),\r\n            bookPath: bookPath,\r\n            restore: false,\r\n            history: true,\r\n            reload: false, // ??\r\n            bookmarks: undefined,\r\n            annotations: undefined,\r\n            contained: undefined,\r\n            sectionId: undefined,\r\n            styles: undefined,\r\n            reflowText: false, // ??\r\n            pagination: false, // ??\r\n            language: undefined\r\n        });\r\n\r\n        if (this.settings.restore && this.isSaved()) {\r\n            this.applySavedSettings();\r\n        }\r\n\r\n        if (this.settings.bookmarks === undefined) {\r\n            this.settings.bookmarks = [];\r\n        }\r\n\r\n        if (this.settings.annotations === undefined) {\r\n            this.settings.annotations = [];\r\n        }\r\n\r\n        if (this.settings.styles === undefined) {\r\n            this.settings.styles = { fontSize: '100%' };\r\n        }\r\n\r\n        if (this.settings.language === undefined) {\r\n            this.settings.language = 'en';\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Get book key.\r\n     * @param {*} identifier (url | blob)\r\n     * @returns Book key (MD5).\r\n     */\r\n    getBookKey(identifier) {\r\n\r\n        return 'epubjs-reader:' + md5(identifier);\r\n    }\r\n    \r\n    /**\r\n     * Set book key in settings.\r\n     * @param {*} identifier (url | blob)\r\n     * @returns Current book key.\r\n     */\r\n    setBookKey(identifier) {\r\n\r\n        if (this.settings.bookKey === undefined) {\r\n            this.settings.bookKey = this.getBookKey(identifier);\r\n        }\r\n        return this.settings.bookKey;\r\n    }\r\n\r\n    /**\r\n     * Checks if the book setting can be retrieved from localStorage.\r\n     * @returns true if the book key exists, or false otherwise.\r\n     */\r\n    isSaved() {\r\n\r\n        if (!localStorage)\r\n            return false;\r\n        \r\n        return localStorage.getItem(this.settings.bookKey) !== null;\r\n    }\r\n\r\n    /**\r\n     * Removing the current book settings from local storage.\r\n     * @returns true if the book settings were deleted successfully, or false \r\n     * otherwise.\r\n     */\r\n    removeSavedSettings() {\r\n\r\n        if (!this.isSaved())\r\n            return false;\r\n\r\n        localStorage.removeItem(this.settings.bookKey);\r\n        return true;\r\n    }\r\n\r\n    applySavedSettings() {\r\n\r\n        if (!localStorage)\r\n            return false;\r\n\r\n        let stored;\r\n        try {\r\n            stored = JSON.parse(localStorage.getItem(this.settings.bookKey));\r\n        } catch (e) { // parsing error of localStorage\r\n            console.exception(e);\r\n        }\r\n\r\n        if (stored) {\r\n            // Merge styles\r\n            if (stored.styles) {\r\n                this.settings.styles = this.defaults(this.settings.styles || {},\r\n                    stored.styles);\r\n            }\r\n            // Merge the rest\r\n            this.settings = this.defaults(this.settings, stored);\r\n            return true;\r\n        } else {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Saving the current book settings in local storage.\r\n     * @returns \r\n     */\r\n    saveSettings() {\r\n\r\n        if (this.book) {\r\n\r\n            if (this.rendition.location) {\r\n                const curLocation = this.rendition.currentLocation();\r\n                this.settings.previousLocationCfi = curLocation.start.cfi;\r\n            }\r\n        }\r\n\r\n        if (!localStorage)\r\n            return false;\r\n\r\n        localStorage.setItem(this.settings.bookKey, JSON.stringify(this.settings));\r\n        return true;\r\n    }\r\n\r\n    unload() {\r\n        \r\n        if (this.settings.restore && localStorage) {\r\n            this.saveSettings();\r\n        }\r\n    }\r\n\r\n    hashChanged() {\r\n\r\n        const hash = window.location.hash.slice(1);\r\n        this.rendition.display(hash);\r\n    }\r\n\r\n    setLocation(cfi) {\r\n\r\n        const baseUrl = this.book.archived ? undefined : this.book.url;\r\n        const url = new URL(window.location, baseUrl);\r\n        url.hash = \"#\" + cfi;\r\n\r\n        // Update the History Location\r\n        if (this.settings.history && window.location.hash !== url.hash) {\r\n            // Add CFI fragment to the history\r\n            window.history.pushState({}, \"\", url);\r\n            this.currentLocationCfi = cfi;\r\n        }\r\n    }\r\n\r\n    generatePagination() {\r\n        //\r\n        // no implemented\r\n        //\r\n        //const rect = this.content.viewer.getRect();\r\n        //this.book.generatePagination(rect.width, rect.height);\r\n    }\r\n\r\n    keyboardHandler(e) {\r\n\r\n        const MOD = (e.ctrlKey || e.metaKey);\r\n\r\n        if (MOD) {\r\n\r\n            const step = 2;\r\n            let value = parseInt(this.settings.styles.fontSize);\r\n\r\n            switch (e.key) {\r\n\r\n                case '=':\r\n                    e.preventDefault();\r\n                    value += step;\r\n                    this.emit('fontresize', value);\r\n                    break;\r\n                case '-':\r\n                    e.preventDefault();\r\n                    value -= step;\r\n                    this.emit('fontresize', value);\r\n                    break;\r\n                case '0':\r\n                    e.preventDefault();\r\n                    value = 100;\r\n                    this.emit('fontresize', value);\r\n                    break;\r\n            }\r\n        } else {\r\n\r\n            switch (e.key) {\r\n                case 'ArrowLeft':\r\n                    this.emit('prev');\r\n                    e.preventDefault();\r\n                    break;\r\n                case 'ArrowRight':\r\n                    this.emit('next');\r\n                    e.preventDefault();\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nEventEmitter(Reader.prototype);\r\n","export class Storage {\r\n\r\n\tconstructor() {\r\n\t\t\r\n\t\tthis.name = 'epubjs-reader';\r\n\t\tthis.version = 1.0;\r\n\t\tthis.database;\r\n\t\tthis.indexedDB = window.indexedDB || \r\n\t\t\t\t\t\t window.webkitIndexedDB || \r\n\t\t\t\t\t\t window.mozIndexedDB ||\r\n\t\t\t\t\t\t window.OIndexedDB ||\r\n\t\t\t\t\t\t window.msIndexedDB;\r\n\t\t\r\n\t\tif (this.indexedDB === undefined) {\r\n\r\n\t\t\talert('The IndexedDB API not available in your browser.');\r\n\t\t}\r\n\t}\r\n\r\n\tinit(callback) {\r\n\r\n\t\tif (this.indexedDB === undefined) {\r\n\t\t\tcallback();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tconst scope = this;\r\n\t\tconst request = indexedDB.open(this.name, this.version);\r\n\t\trequest.onupgradeneeded = function (event) {\r\n\r\n\t\t\tconst db = event.target.result;\r\n\t\t\tif (db.objectStoreNames.contains('entries') === false) {\r\n\r\n\t\t\t\tdb.createObjectStore(\"entries\");\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\trequest.onsuccess = function (event) {\r\n\r\n\t\t\tscope.database = event.target.result;\r\n\t\t\tscope.database.onerror = function (event) {\r\n\r\n\t\t\t\tconsole.error('IndexedDB', event);\r\n\t\t\t};\r\n\t\t\tcallback();\r\n\t\t}\r\n\r\n\t\trequest.onerror = function (event) {\r\n\r\n\t\t\tconsole.error('IndexedDB', event);\r\n\t\t};\r\n\t}\r\n\r\n\tget(callback) {\r\n\r\n\t\tif (this.database === undefined) {\r\n\t\t\tcallback();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tconst transaction = this.database.transaction(['entries'], 'readwrite');\r\n\t\tconst objectStore = transaction.objectStore('entries');\r\n\t\tconst request = objectStore.get(0);\r\n\t\trequest.onsuccess = function (event) {\r\n\r\n\t\t\tcallback(event.target.result);\r\n\t\t\tconsole.log('storage.get');\r\n\t\t};\r\n\t}\r\n\r\n\tset(data, callback) {\r\n\t\t\r\n\t\tif (this.database === undefined) {\r\n\t\t\tcallback();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tconst transaction = this.database.transaction(['entries'], 'readwrite');\r\n\t\tconst objectStore = transaction.objectStore('entries');\r\n\t\tconst request = objectStore.put(data, 0);\r\n\t\trequest.onsuccess = function () {\r\n\r\n\t\t\tcallback();\r\n\t\t\tconsole.log('storage.set');\r\n\t\t};\r\n\t}\r\n\r\n\tclear() {\r\n\r\n\t\tif (this.database === undefined)\r\n\t\t\treturn;\r\n\r\n\t\tconst transaction = this.database.transaction(['entries'], 'readwrite');\r\n\t\tconst objectStore = transaction.objectStore('entries');\r\n\t\tconst request = objectStore.clear();\r\n\t\trequest.onsuccess = function () {\r\n\r\n\t\t\tconsole.log('storage.clear');\r\n\t\t};\r\n\t}\r\n}\r\n","import { Reader } from './reader.js';\r\nimport { Storage } from './storage.js';\r\n\r\n\"use strict\";\r\n\r\nwindow.onload = function () {\r\n\r\n\tconst storage = new Storage();\r\n\tconst url = new URL(window.location);\r\n\tconst path = url.search.length > 0 \r\n\t\t? url.searchParams.get(\"bookPath\") \r\n\t\t: \"https://s3.amazonaws.com/moby-dick/\";\r\n\r\n\tstorage.init(function () {\r\n\r\n\t\tstorage.get(function (data) {\r\n\r\n\t\t\tif (data !== undefined && url.search.length === 0) {\r\n\r\n\t\t\t\twindow.reader = new Reader(data, { restore: true });\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\twindow.reader = new Reader(path, { restore: true });\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\r\n\twindow.storage = storage;\r\n};"],"names":["isValue","isPlainFunction","assign","normalizeOpts","contains","module","exports","dscr","value","c","e","w","options","desc","arguments","length","call","configurable","enumerable","writable","gs","get","set","undefined","Object","obj","foo","bar","trzy","keys","max","Math","dest","src","error","i","key","forEach","_undefined","val","object","Array","prototype","create","process","opts1","result","fn","TypeError","String","str","indexOf","searchString","this","on","once","off","emit","methods","descriptors","base","d","callable","apply","Function","defineProperty","defineProperties","hasOwnProperty","descriptor","type","listener","self","__eeOnceListener__","data","__ee__","push","listeners","candidate","splice","l","args","slice","o","isPrototype","possibleTypes","isFunction","classRe","functionToString","toString","test","isObject","constructor","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","n","getter","__esModule","a","definition","prop","errormsg","UIElement","dom","add","argument","appendChild","isArray","j","element","console","remove","removeChild","clear","children","lastChild","setId","id","getId","setClass","name","className","addClass","classList","removeClass","setStyle","style","array","setDisabled","disabled","setTextContent","textContent","getRect","getBoundingClientRect","property","method","substr","toUpperCase","event","callback","addEventListener","toLowerCase","bind","UISpan","super","document","createElement","UIDiv","UIRow","UIPanel","UILabel","text","htmlFor","UIText","setValue","getValue","UILink","uri","label","href","UIInput","title","stopPropagation","setTitle","getName","setName","getType","setType","getTitle","readonly","readOnly","UITextArea","spellcheck","keyCode","preventDefault","cursor","selectionStart","substring","selectionEnd","UISelect","setMultiple","boolean","multiple","setOptions","selected","firstChild","option","innerHTML","UIInteger","step","min","UITabbedPanel","align","tabs","panels","selector","tabsDiv","panelsDiv","select","tab","panel","find","item","setDisplay","size","rect","width","transform","height","addTab","items","UITab","parent","button","UITreeView","UITreeViewItem","link","toggle","expander","expanded","setItems","subItems","onclick","collaps","expand","getElementsByTagName","unselect","removeAttribute","display","MetadataPanel","reader","creator","separator","meta","init","Toolbar","strings","container","start","opener","openerStr","isOpen","center","end","open","uploadStr","storage","window","accept","target","files","FileReader","fr","onload","unload","restore","readAsArrayBuffer","onerror","location","includes","origin","pathname","alert","bookmark","bookmarkStr","cfi","rendition","currentLocation","isBookmarked","fullscreenEnabled","fullscreen","fullscreenStr","toggleFullScreen","screen","path","innerWidth","h","innerHeight","body","activeElement","blur","fullscreenElement","documentElement","requestFullscreen","exitFullscreen","TocPanel","toc","generateToc","chapter","treeItem","settings","sectionId","subitems","BookmarksPanel","ctrlRow","ctrlStr","btn_a","btn_r","btn_c","clearBookmarks","bookmarks","update","createBookmarkItem","addBookmark","removeBookmark","index","childNodes","hasChildNodes","book","spineItem","spine","navigation","tocItem","AnnotationsPanel","notes","textBox","isSelected","range","cfiRange","textRow","note","date","Date","uuid","annotations","clearNotes","startOffset","endOffset","contents","btnr","len","SearchPanel","searchQuery","searchBox","placeholder","onsearch","doSearch","then","results","async","q","Promise","all","spineItems","map","load","finally","resolve","concat","excerpt","SettingsPanel","languageStr","languageRow","language","en","ja","ru","fontSizeStr","fontSizeRow","fontSize","reflowTextStr","reflowTextRow","reflowText","checked","resize","paginationStr","paginationRow","pagination","generatePagination","Sidebar","search","Content","main","sidebarReflow","prev","next","viewer","divider","loader","showDivider","spreads","slideOut","slideIn","props","spread","spreadWidth","atStart","atEnd","setTimeout","Strings","values","Reader","bookPath","_options","cfgInit","toolbar","sidebar","content","displayed","hashChanged","keyboardHandler","ctrlKey","passive","ePub","renderTo","previousLocationCfi","renderer","ready","parseInt","styles","loaded","metadata","view","getSelection","getRangeAt","setLocation","themes","package","direction","defaults","source","getTime","replace","r","random","floor","isAnnotated","bookKey","getBookKey","history","reload","contained","isSaved","applySavedSettings","identifier","md5","setBookKey","localStorage","getItem","removeSavedSettings","removeItem","stored","JSON","parse","exception","saveSettings","curLocation","setItem","stringify","hash","baseUrl","archived","url","URL","pushState","currentLocationCfi","metaKey","Storage","version","database","indexedDB","webkitIndexedDB","mozIndexedDB","OIndexedDB","msIndexedDB","scope","request","onupgradeneeded","db","objectStoreNames","createObjectStore","onsuccess","transaction","objectStore","log","put","searchParams"],"sourceRoot":""}